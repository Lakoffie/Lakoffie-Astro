---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';
import '../../styles/artikel.css';

const semuaArtikel = await getCollection('artikel');

const sortedArtikel = semuaArtikel.sort((a, b) => 
  b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const categories = ['Semua', 'Tips', 'Edukasi', 'Trending'];
---

<MainLayout title="Artikel Lakoffie | Inspirasi Kopi Murni">
  <div class="article-page-wrapper">
    <div class="container" style="padding: 80px 0 40px; text-align: center;">
      <span style="color: var(--gold); letter-spacing: 5px; font-size: 0.7rem; text-transform: uppercase; display: block; margin-bottom: 10px;">The Coffee Journal</span>
      <h1 style="font-family: serif; font-size: clamp(2rem, 5vw, 3.5rem); margin-top: 10px;">Inspirasi & <span style="color: var(--gold)">Edukasi</span></h1>
    </div>

    <div class="container">
      <div class="blog-controls">
        <div class="tabs">
          {categories.map(cat => (
            <button class="tab-btn" data-category={cat}>{cat}</button>
          ))}
        </div>
        <div class="search-wrapper">
           <input type="text" id="searchBlog" placeholder="Cari judul..." />
        </div>
      </div>

      <div class="blog-grid" id="blogGrid">
        {sortedArtikel.map(a => (
          <article class="blog-card" data-category={a.data.tags[0]}>
            <div class="blog-img">
              <img src={a.data.image} alt={a.data.alt} loading="lazy" />
              <div class="card-tag">{a.data.tags[0]}</div>
            </div>
            <div class="blog-content">
              <span class="blog-date">{a.data.pubDate.toLocaleDateString('id-ID')}</span>
              <h3>{a.data.title}</h3>
              <p>{a.data.description}</p>
              <a href={`/artikel/${a.slug || a.id}`} class="read-link">Baca Selengkapnya â†’</a>
            </div>
          </article>
        ))}
      </div>
    </div>
  </div>
</MainLayout>

<script is:inline>
  const searchInput = document.getElementById('searchBlog');
  const cards = document.querySelectorAll('.blog-card');
  const tabBtns = document.querySelectorAll('.tab-btn');

  searchInput?.addEventListener('input', () => {
    const val = searchInput.value.toLowerCase();
    cards.forEach(card => {
      const text = card.innerText.toLowerCase();
      card.style.display = text.includes(val) ? 'block' : 'none';
    });
  });

  tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const cat = btn.dataset.category.toLowerCase();
      tabBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      cards.forEach(card => {
        const cardCat = card.dataset.category.toLowerCase();
        card.style.display = (cat === 'semua' || cardCat === cat) ? 'block' : 'none';
      });
    });
  });
</script>

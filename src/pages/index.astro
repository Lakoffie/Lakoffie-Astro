---
// src/pages/index.astro
import MainLayout from '../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import { varianKopi } from '../data/kopi'; 
import '../styles/home.css';

// 1. Ambil 3 artikel terbaru dengan pengamanan data
const semuaArtikel = await getCollection('artikel');
const artikelTerbaru = semuaArtikel
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

// Filter produk baru untuk trigger pop-up
const produkBaru = varianKopi.find(k => k.isNew);
---

<MainLayout title="Lakoffie | Kopi Bubuk Murni Rasa Cafe">
  
  <header class="hero">
    <div class="hero-content">
      <span class="badge">Bukan Sekadar Kopi Hitam</span>
      <h1 class="glare-text">Selama Ini Kamu Kira <br/><span>Kopi Cuma Pahit?</span></h1>
      
      <div class="marketing-hook">
        <p class="hero-intro-bold">Upgrade ritual kopimu hari ini.</p>
        <p class="hero-desc">
          Rasakan kemewahan 100% biji kopi pilihan dengan aroma gula jawa dan sensasi asam elegan. 
          <span class="gold-italic">Kualitas Signature Cafe, kini bisa diseduh siapa saja, di mana saja.</span>
        </p>
      </div>

      <div class="cta-wrapper">
        <a href="https://wa.me/6285175285640" class="btn-gold">Konsultasi Rasa di WA</a>
      </div>
    </div>
  </header>

  <section class="value-bar-luxury">
    <div class="container-value">
      <div class="value-item-soft">
        <div class="value-icon-circle">01</div>
        <div class="value-info">
          <h3>Eksplorasi Rasa</h3>
          <p>Kenapa harus puas dengan satu rasa, jika setiap seduhan bisa menceritakan petualangan yang berbeda?</p>
        </div>
      </div>

      <div class="value-item-soft">
        <div class="value-icon-circle">02</div>
        <div class="value-info">
          <h3>Kemewahan Inklusif</h3>
          <p>Menikmati kopi kualitas <em>specialty</em> bukan lagi soal gengsi, tapi soal hak lidahmu untuk dimanja setiap pagi.</p>
        </div>
      </div>

      <div class="value-item-soft">
        <div class="value-icon-circle">03</div>
        <div class="value-info">
          <h3>Kejujuran Alam</h3>
          <p>Saat yang lain berkompromi dengan campuran, kami memilih tetap setia pada kemurnian biji kopi pilihan.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="sensory-experience">
    <div class="container">
      <h2>Catatan Rasa yang Akan <span class="gold-text">Anda Temukan</span></h2>
      <div class="fact-row-premium">
        <div class="fact-item">
          <span class="icon">üç´</span>
          <div class="fact-text">
            <strong>Aroma Gula Jawa</strong>
            <p>Manis alami yang menenangkan</p>
          </div>
        </div>
        <div class="fact-item">
          <span class="icon">‚òï</span>
          <div class="fact-text">
            <strong>Bold Body</strong>
            <p>Tekstur kental yang mantap</p>
          </div>
        </div>
        <div class="fact-item">
          <span class="icon">üçã</span>
          <div class="fact-text">
            <strong>Asam Elegan</strong>
            <p>Kesegaran buah di setiap sesapan</p>
          </div>
        </div>
      </div>
      <div class="cta-bottom">
         <p>Masa nggak pengin ngopi nikmat ala caf√© dengan harga bersahabat?</p>
         <a href="https://wa.me/6285175285640" class="btn-outline">Lihat Koleksi Kopi</a>
      </div>
    </div>
  </section>

  <section class="products">
    <div class="section-header">
      <span class="badge">Selected Beans</span>
      <h2>Varian Kopi Spesial</h2>
      <p class="section-desc">Setiap biji bercerita tentang tanah asalnya. Temukan karakter yang paling mewakili <span class="gold-text">identitas lidahmu.</span></p>
    </div>

    <div class="product-grid">
      {varianKopi.map((v) => (
        <div class="product-card">
          {v.hargaPromo && <div class="promo-ribbon">PROMO</div>}
          <div class="card-image">
             <img src={v.image} alt={v.alt} />
             <div class="pure-badge">100% Pure</div>
          </div>
          <div class="card-info">
            <span class="series-label">Signature Series</span>
            <h3>{v.nama}</h3>
            <p class="karakter">{v.karakter}</p>
            <div class="price-wrapper">
              {v.hargaPromo ? (
                <div class="promo-price-stack">
                  <span class="old-price">{v.harga}</span>
                  <span class="price-promo">{v.hargaPromo}</span>
                </div>
              ) : (
                <span class="price">{v.harga}</span>
              )}
            </div>
            <div class="product-actions">
              <a href={`/produk/${v.slug}/`} class="btn-outline">Detail</a>
              <a href="https://wa.me/6285175285640" class="btn-gold">Beli</a>
            </div>
          </div>
        </div>
      ))}
    </div>
  </section>

  <section class="home-journal">
    <div class="container">
      <div class="journal-header">
        <div>
          <span class="badge">Journal</span>
          <h2>Wawasan & <span class="gold-text italic">Inspirasi</span></h2>
        </div>
        <a href="/artikel" class="btn-text-gold">Buka Arsip ‚Üí</a>
      </div>

      <div class="journal-preview-grid">
        {artikelTerbaru.map((post) => (
          <article class="luxury-journal-card">
            <div class="journal-visual">
              <img src={post.data.image} alt={post.data.alt} loading="lazy" />
              <div class="journal-tag-float">{post.data.tags?.[0] || 'Coffee'}</div>
            </div>
            <div class="journal-body">
              <h3>{post.data.title}</h3>
              <p>
                {post.data.description 
                  ? post.data.description.substring(0, 95) + "..." 
                  : "Jelajahi wawasan menarik seputar dunia kopi murni Lakoffie selengkapnya di sini."}
              </p>
              <div class="journal-footer">
                <a href={`/artikel/${post.slug || post.id}`} class="link-explore">
                  Jelajahi Cerita
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </a>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <section class="testi">
     <h2>Apa Kata Penikmat?</h2>
     <div class="testi-grid">
        <div class="testi-card"><p>Aromanya beda... Gula jawa-nya kerasa banget.</p><cite>‚Äî Budi Santoso</cite></div>
        <div class="testi-card"><p>Kualitas kopi caf√© tapi bisa bikin sendiri di rumah.</p><cite>‚Äî Sarah Wijaya</cite></div>
        <div class="testi-card"><p>Layanan WA-nya ramah, konsultasi dulu sebelum beli.</p><cite>‚Äî Andi Pratama</cite></div>
     </div>
  </section>

  <section class="market">
    <h3>Dapatkan Secara Online</h3>
    <div class="market-links">
      <a href="https://www.shopee.co.id/Lakoffie">Shopee</a>
      <a href="https://www.tokopedia.com/Lakoffie">Tokopedia</a>
      <a href="https://www.tiktok.com/@lakoffie_">TikTok Shop</a>
    </div>
    <div class="mitra-cta">
      <p>Ingin merasakan langsung atau ambil di tempat?</p>
      <a href="/mitra" class="btn-mitra-luxury">Cek Lokasi Mitra üìç</a>
    </div>
  </section>

  {produkBaru && (
    <div id="newProductModal" class="modal-overlay">
      <div class="modal-content">
        <button id="closeModal" class="close-btn" aria-label="Close">&times;</button>
        <div class="modal-grid">
          <div class="modal-visual">
            <img src={produkBaru.image} alt={produkBaru.alt} class="modal-img" />
            <div class="visual-overlay"></div>
          </div>
          <div class="modal-body">
            <span class="gold-label">Eksklusif Terbaru</span>
            <h2>{produkBaru.nama}</h2>
            <div class="divider"></div>
            <p class="modal-desc">
              Rasakan simfoni rasa yang belum pernah ada sebelumnya. {produkBaru.karakter} yang diracik khusus untuk standar lidah Master.
            </p>
            <div class="modal-cta-group">
              <a href={`/produk/${produkBaru.slug}`} class="btn-primary-modal">Jelajahi Rasa</a>
              <p class="limited-tag">*Persediaan Terbatas</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  )}

</MainLayout>

<style>
  /* --- Style Tetap Sama --- */
  .home-journal { padding: 6rem 0; background: #0c0b0a; }
  .journal-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 3.5rem; }
  .journal-preview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2.5rem; }
  .luxury-journal-card { background: #141311; border-radius: 20px; overflow: hidden; border: 1px solid rgba(191, 149, 63, 0.15); transition: all 0.4s ease; }
  .luxury-journal-card:hover { transform: translateY(-10px); border-color: rgba(191, 149, 63, 0.5); box-shadow: 0 15px 30px rgba(0,0,0,0.5); }
  .journal-visual { height: 220px; position: relative; overflow: hidden; }
  .journal-visual img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.7); transition: 0.5s; }
  .luxury-journal-card:hover .journal-visual img { filter: brightness(1); transform: scale(1.05); }
  .journal-tag-float { position: absolute; bottom: 15px; left: 15px; background: var(--gold); color: #000; font-size: 0.65rem; font-weight: bold; padding: 4px 12px; border-radius: 4px; text-transform: uppercase; }
  .journal-body { padding: 2rem; }
  .journal-body h3 { color: #fff; font-family: serif; font-size: 1.4rem; margin-bottom: 1rem; line-height: 1.3; }
  .journal-body p { color: #888; font-size: 0.9rem; line-height: 1.6; margin-bottom: 1.5rem; height: 3.2em; overflow: hidden; }
  .journal-footer { border-top: 1px solid rgba(255,255,255,0.05); padding-top: 1.5rem; }
  .link-explore { color: var(--gold); text-decoration: none; font-weight: bold; font-size: 0.85rem; display: flex; align-items: center; gap: 8px; transition: 0.3s; }
  .link-explore:hover { gap: 15px; }
  .btn-text-gold { color: var(--gold); text-decoration: none; font-weight: bold; border-bottom: 1px solid transparent; transition: 0.3s; }
  .btn-text-gold:hover { border-color: var(--gold); }
  @media (max-width: 768px) { .journal-header { flex-direction: column; align-items: flex-start; gap: 1rem; } }
</style>

<script is:inline>
  window.addEventListener('load', () => {
    const modal = document.getElementById('newProductModal');
    const closeBtn = document.getElementById('closeModal');
    const hasSeenPopup = sessionStorage.getItem('seenNewProduct');
    if (!hasSeenPopup && modal) {
      setTimeout(() => {
        modal.style.display = 'flex';
        modal.style.opacity = '1';
      }, 4000);
    }
    const handleClose = () => {
      if(modal) {
        modal.style.display = 'none';
        sessionStorage.setItem('seenNewProduct', 'true');
      }
    };
    closeBtn?.addEventListener('click', handleClose);
    window.addEventListener('click', (e) => { if (e.target === modal) handleClose(); });
  });
</script>

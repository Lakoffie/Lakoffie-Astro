---
// src/pages/index.astro
import MainLayout from '../layouts/MainLayout.astro';
import { varianKopi } from '../data/kopi'; // Pastikan Master sudah membuat file src/data/kopi.ts
import '../styles/home.css';

// Filter produk baru untuk trigger pop-up secara dinamis
const produkBaru = varianKopi.find(k => k.isNew);
---

<MainLayout title="Lakoffie | Kopi Bubuk Murni Rasa Cafe">
  
  <header class="hero">
    <div class="hero-content">
      <span class="badge">Bukan Sekadar Kopi Hitam</span>
      <h1 class="glare-text">Selama Ini Kamu Kira <br/><span>Kopi Cuma Pahit?</span></h1>
      
      <div class="marketing-hook">
        <p class="hero-intro-bold">Upgrade ritual kopimu hari ini.</p>
        <p class="hero-desc">
          Rasakan kemewahan 100% biji kopi pilihan dengan aroma gula jawa dan sensasi asam elegan. 
          <span class="gold-italic">Kualitas Signature Cafe, kini bisa diseduh siapa saja, di mana saja.</span>
        </p>
      </div>

      <div class="cta-wrapper">
        <a href="https://wa.me/6285175285640" class="btn-gold">Konsultasi Rasa di WA</a>
      </div>
    </div>
  </header>

<section class="value-bar-luxury">
  <div class="container-value">
    <div class="value-item-soft">
      <div class="value-icon-circle">01</div>
      <div class="value-info">
        <h3>Eksplorasi Rasa</h3>
        <p>Kenapa harus puas dengan satu rasa, jika setiap seduhan bisa menceritakan petualangan yang berbeda?</p>
      </div>
    </div>

    <div class="value-item-soft">
      <div class="value-icon-circle">02</div>
      <div class="value-info">
        <h3>Kemewahan Inklusif</h3>
        <p>Menikmati kopi kualitas <em>specialty</em> bukan lagi soal gengsi, tapi soal hak lidahmu untuk dimanja setiap pagi.</p>
      </div>
    </div>

    <div class="value-item-soft">
      <div class="value-icon-circle">03</div>
      <div class="value-info">
        <h3>Kejujuran Alam</h3>
        <p>Saat yang lain berkompromi dengan campuran, kami memilih tetap setia pada kemurnian biji kopi pilihan.</p>
      </div>
    </div>
  </div>
</section>

  <section class="sensory-experience" style="padding: 4rem 0; background: #0c0b0a;">
    <div class="container">
      <h2 style="text-align: center; color: #fff; font-family: serif; margin-bottom: 2rem; font-size: 1.5rem;">
        Catatan Rasa yang Akan <span style="color: var(--gold);">Anda Temukan</span>
      </h2>
      <div class="fact-row-premium">
        <div class="fact-item">
          <span class="icon">ğŸ«</span>
          <div class="fact-text">
            <strong>Aroma Gula Jawa</strong>
            <p>Manis alami yang menenangkan</p>
          </div>
        </div>
        <div class="fact-item">
          <span class="icon">â˜•</span>
          <div class="fact-text">
            <strong>Bold Body</strong>
            <p>Tekstur kental yang mantap</p>
          </div>
        </div>
        <div class="fact-item">
          <span class="icon">ğŸ‹</span>
          <div class="fact-text">
            <strong>Asam Elegan</strong>
            <p>Kesegaran buah di setiap sesapan</p>
          </div>
        </div>
      </div>

      <div class="cta-bottom" style="text-align: center; margin-top: 3rem;">
         <p style="color: #666; margin-bottom: 1.5rem;">Masa nggak pengin ngopi nikmat ala cafÃ© dengan harga bersahabat?</p>
         <a href="https://wa.me/6285175285640" class="btn-outline">Lihat Koleksi Kopi</a>
      </div>
    </div>
  </section>


  <section class="products">
    <div class="section-header">
      <span class="badge">Selected Beans</span>
      <h2>Varian Kopi Spesial</h2>
      <p class="section-desc">Setiap biji bercerita tentang tanah asalnya. Temukan karakter yang paling mewakili <span class="gold-text">identitas lidahmu.</span></p>
    </div>

    <div class="product-grid">
      {varianKopi.map((v) => (
        <div class="product-card">
          {v.hargaPromo && <div class="promo-ribbon">PROMO</div>}
          
          <div class="card-image">
             <img src={v.image} alt={v.alt} />
             <div class="pure-badge">100% Pure</div>
          </div>

          <div class="card-info">
            <span class="series-label">Signature Series</span>
            <h3>{v.nama}</h3>
            <p class="karakter">{v.karakter}</p>
            
            <div class="price-wrapper">
              {v.hargaPromo ? (
                <div class="promo-price-stack">
                  <span class="old-price">{v.harga}</span>
                  <span class="price-promo">{v.hargaPromo}</span>
                </div>
              ) : (
                <span class="price">{v.harga}</span>
              )}
            </div>
            
            <div class="product-actions">
              <a href={`/produk/${v.slug}`} class="btn-outline">Detail</a>
              <a href="https://wa.me/6285175285640" class="btn-gold">Beli</a>
            </div>
          </div>
        </div>
      ))}
    </div>
  </section>

  <section class="testi">
     <h2>Apa Kata Penikmat?</h2>
     <div class="testi-grid">
        <div class="testi-card"><p>Aromanya beda... Gula jawa-nya kerasa banget.</p><cite>â€” Budi Santoso</cite></div>
        <div class="testi-card"><p>Kualitas kopi cafÃ© tapi bisa bikin sendiri di rumah.</p><cite>â€” Sarah Wijaya</cite></div>
        <div class="testi-card"><p>Layanan WA-nya ramah, konsultasi dulu sebelum beli.</p><cite>â€” Andi Pratama</cite></div>
     </div>
  </section>

  <section class="market">
    <h3>Dapatkan Secara Online</h3>
    <div class="market-links">
      <a href="https://www.shopee.co.id/Lakoffie">Shopee</a>
      <a href="https://www.tokopedia.com/Lakoffie">Tokopedia</a>
      <a href="https://www.tiktok.com/@lakoffie_">TikTok Shop</a>
    </div>
    <div class="mitra-cta">
      <p>Ingin merasakan langsung atau ambil di tempat?</p>
      <a href="/mitra" class="btn-mitra-luxury">Cek Lokasi Mitra ğŸ“</a>
    </div>
  </section>

  {produkBaru && (
  <div id="newProductModal" class="modal-overlay">
    <div class="modal-content">
      <button id="closeModal" class="close-btn" aria-label="Close">&times;</button>
      
      <div class="modal-grid">
        <div class="modal-visual">
          <img src={produkBaru.image} alt={produkBaru.alt} class="modal-img" />
          <div class="visual-overlay"></div>
        </div>
        
        <div class="modal-body">
          <span class="gold-label">Eksklusif Terbaru</span>
          <h2>{produkBaru.nama}</h2>
          <div class="divider"></div>
          <p class="modal-desc">
            Rasakan simfoni rasa yang belum pernah ada sebelumnya. {produkBaru.karakter} yang diracik khusus untuk standar lidah Master.
          </p>
          
          <div class="modal-cta-group">
            <a href={`/produk/${produkBaru.slug}`} class="btn-primary-modal">
              Jelajahi Rasa
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </a>
            <p class="limited-tag">*Persediaan Terbatas</p>
          </div>
        </div>
      </div>
    </div>
  </div>
)}

</MainLayout>

<script is:inline>
  // Master, logic ini memastikan kesan mewah tidak terganggu oleh pop-up yang muncul terus-menerus
  window.addEventListener('load', () => {
    const modal = document.getElementById('newProductModal');
    const closeBtn = document.getElementById('closeModal');
    
    // 1. Cek Session Storage agar tidak mengganggu user yang sedang asyik browsing
    const hasSeenPopup = sessionStorage.getItem('seenNewProduct');
    
    // 2. Munculkan setelah delay 4 detik (Golden Time agar user tidak kaget)
    if (!hasSeenPopup && modal) {
      setTimeout(() => {
        modal.style.display = 'flex';
        // Tambahkan efek transisi halus jika Master menggunakan CSS opacity
        modal.style.opacity = '1';
      }, 4000);
    }

    // 3. Fungsi Menutup Modal & Mencatat Session
    const handleClose = () => {
      modal.style.display = 'none';
      sessionStorage.setItem('seenNewProduct', 'true');
    };

    // Klik Tombol Close (X)
    closeBtn?.addEventListener('click', handleClose);

    // Klik di luar area Modal (Overlay Hitam) untuk menutup
    // Ini standar UX Luxury: User tidak boleh merasa "terjebak"
    window.addEventListener('click', (event) => {
      if (event.target === modal) {
        handleClose();
      }
    });

    // Menutup dengan tombol Escape pada keyboard (Opsional tapi Pro)
    window.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && modal.style.display === 'flex') {
        handleClose();
      }
    });
  });
</script>
